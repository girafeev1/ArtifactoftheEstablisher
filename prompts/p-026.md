P-026 — Finish Payment UX, Add Payment cascade, and list-view session truncation

Save this prompt exactly at: prompts/p-026.md
Branch: codex/finish-payment-ux-and-add-payment-cascade-p026
PR title: feat(payment): finalize sticky footer, remaining blink, session assignment, Add Payment cascade, and history session truncation (P-026)
Labels: payments, ui, codex

Background (post P-024, P-025)

P-024/P-025 shipped new Payment History columns and inline-when-empty editing in the detail view; Remaining/Amount blink logic still needs polishing, and the Back button wasn’t reliably inside the sticky footer in your live test. PR #214 shows edits to PaymentDetail.tsx, PaymentHistory.tsx, BaseRateHistoryDialog.tsx, etc., plus updates to docs/Task Log.md. 
GitHub

Do not modify any GitHub Actions/CI in this task.

Tasks
A) Sticky footer & Back placement

Render the Back control inside the sticky footer (same bar as action buttons).

Ensure the scroll container is the dialog body; add bottom padding equal to footer height so content is never hidden.

Footer CSS (adapt to your stack):
position: sticky; bottom: 0; z-index: 10; border-top: 1px solid var(--mui-palette-divider); box-shadow: 0 -2px 8px rgba(0,0,0,.04); background: inherit;

B) Remaining blink — single source of truth

Ensure Payment Amount is static (no blink).

Ensure Remaining uses the blink class once (no duplicate spans). Remove the second, duplicate rendering that causes flicker. (P-025 currently renders the value twice — fix to one element with the correct class.)

C) Session assignment list — always visible & functional

Keep the assignment table visible even when the computed rows are temporarily 0 (show a zero-state).

Selecting/unselecting sessions updates Remaining and persists via existing hooks/services; the list never disappears due to transient data states.

D) Add Payment dialog — cascade & writes

Implement the full cascade and writes exactly as specified earlier:

Payment Method — dropdown with: FPS, Bank Transfer, Cheque → save to method: string.

Entity — dropdown: Music Establish (by ERL) or Personal → save to entity.

If Entity = Music Establish (by ERL):

Bank dropdown: list banks from your ERL directory DB (e.g., erl-directory database). Show each tab as {bank name} {bankCode} (fallback label: {documentId} {collectionId} if needed).

Bank Account dropdown: for the chosen bank, list sub-collection accounts; label with each account’s accountType (your internal account identifier).

On submit, set identifier = "{bankCode}/{accountDocId}".

Reference Number — free text → refNumber: string.

Rename Save to Submit.

On submit, also stamp timestamp and editedBy.

Reuse the normalization from P-024: if a typed identifier doesn’t match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, recompute from bankCode + accountDocId.

E) Payment History (list view): For Session(s) truncation

Add the “For Session(s)” column in the list view (if removed/hidden), display up to 5 session ordinals; if more, show … after the 5th (no count needed here; detail view already has (+N more)).

Cells ellipsize; no column header should prevent narrowing.

F) Column header width decouple

Ensure header text can ellipsize independently of cell contents so narrow columns are possible even when headers are long (e.g., set table-layout: fixed, apply overflow: hidden; text-overflow: ellipsis; white-space: nowrap to th while cell widths remain resizable).

Tests

Unit: keep current tests green; if you add small helpers (e.g., for session truncation), test them.

E2E/Component (Cypress):

Only Remaining blinks when changing selected sessions; Payment Amount never blinks.

Session assignment table is visible on empty/zero states and updates Remaining on selection.

Add Payment cascade:

Choose Method, Entity=ERL, pick Bank → Bank Account → Submit; verify method, entity, identifier, refNumber, and audit fields (timestamp, editedBy) are written.

Payment History list shows For Session(s) with at most 5 ordinals and … when longer.

If CI lacks GUI deps, keep specs committed; conditional skip in CI is fine. Do not touch Actions.

Acceptance criteria

Back button sits inside the sticky footer; footer sticks to the window edge, not the scroller.

Remaining blinks correctly; no duplicate span/render.

Session assignment list stays visible with a zero-state and works end-to-end.

Add Payment cascade works; identifier stored as {bankCode}/{accountDocId}; audit fields recorded.

Payment History shows “For Session(s)” with 5-then-ellipsis.

No new TS errors.

Save this prompt

Create exactly prompts/p-026.md and copy this prompt’s full text into it (no renames).
