P-028-01r — Stop selection spam, fix ERL cascade summary, footer overlap, and action icons

PR title: feat(billing): stop selection spam; ERL summary block; opaque footer; bottom-anchored controls; unified filter+create icons (P-028-01r)

**Save:** `prompts/p-028-01r.md`

Codex: do not merely save this file. Implement the changes, open a PR, and make sure tests pass.

A) Selection spam → OFF (detail & add flows)
No writes and no UI logs on intermediate dropdown changes (Entity/Bank/Account/Method) in Payment Detail and Add Payment.
Keep changes in local state; write to Firestore only on Submit/Save.
Gate any dev logs with process.env.NODE_ENV !== 'production' and do not push logs into the UI or Firestore.
Acceptance: Selecting Entity/Bank/Account/Method does not alter the visible history list or write to DB until Submit/Save. No selection trail appears in the Payment History UI.

B) ERL cascade → post-selection summary block (Payment Detail)
After the user completes the cascade in Payment Detail and saves:
- Hide the input fields (except Remaining Amount).
- Show a consolidated, read-only summary block:
  Payment made by – {firstName}, {lastName} on {Payment Date} thru {Method} to Establish Records Limited: {Bank Name} ({Bank Code}) {accountType} {accountNumber} for {Amount}
  Notes: If entity !== "Music Establish (ERL)", the “to Establish Records Limited:” line is omitted.
  Values are sourced from the selected payment + selected ERL account document: Bank Name and Bank Code come from the selected bank option (label already Name (code)). accountType, accountNumber from the selected bank account doc (fallback to N/A if missing).
- Keep Remaining amount visible and live (still updates with session assignment).
Acceptance: After saving, inputs collapse and the summary appears exactly as above (with fallbacks). A small “Edit details” link re-enables the fields if needed.

C) Bank label & path rules (carry-forward)
Bank dropdown label: "{Bank Name} ({Bank Code})". Internal value remains the normalized code, e.g. "040".
When reading legacy structure, always use the parenthesized path segment: /bankAccount/{bankName}/({code})/*.
Continue preferring /banks/{code}/accounts/*; fallback to /bankAccount/{bankName}/({code})/*. Merge/dedupe by accountDocId if both exist.
Acceptance: Bank menu shows Name (040). Accounts appear from correct path(s). No crash if one path is missing.

D) Footer overlap + bottom-anchored controls (layout)
Make student dialog/footer opaque (no transparency) and ensure the scrollable region has bottom padding so content never sits beneath the footer.
Service Mode and Settings must live in a bottom, screen-anchored layer (as before), not inside the card list/footer.
Use position: fixed at viewport bottom (safe area aware), with z-index above content but below dialogs.
Maintain baseline alignment and never overlap the footer.
Acceptance: Scrolling never visually overlaps footer elements. Settings & Service Mode stay pinned to screen bottom on every page, independent of card list scrolling.

E) Payment History filter UX
Unify all filter triggers to a filter favicon (use the same icon everywhere).
In Payment History: Move the filter button under the page title (not in the footer).
Default visible columns remain: Date, Amount, For Session(s). Others toggleable via popover; persist per user.
Acceptance: Filter icon sits just below the Payment History title. Column visibility persists across reload.

F) Action icons → “create document” metaphor
Replace “add” icons with a consistent “create document” look: Add Payment: use a “create document” icon (e.g. NoteAddRounded or equivalent). Add Voucher: same metaphor/icon family. Add Retainer: same metaphor/icon family.
Acceptance: All three actions use the unified “create document” style; tooltips updated accordingly.

G) Identifier on submit (unchanged, verified)
On Submit/Save (Add or Detail), if entity === "Music Establish (ERL)", store: bankCode, accountDocId, and identifier = "${bankCode}/${accountDocId}", plus timestamp, editedBy, and refNumber (when provided).
Acceptance: DB write matches the above exactly; no intermediate writes.

Tests
- No-spam behavior: Detail & Add – change Entity/Bank/Account/Method → no Firestore write until Submit. UI shows no selection log lines.
- Summary block: After save, inputs hide; summary renders with expected lines and values; “Edit details” toggles fields back.
- Bank label/path: Label is Name (040); accounts load from /banks/040/accounts/* or fallback /bankAccount/Name/(040)/*.
- Layout: Footer remains visible and opaque; scroll never overlaps. Settings & Service Mode are viewport-bottom anchored on all screens.
- Filters & icons: Payment History filter icon under title; columns persist. Add Payment/Voucher/Retainer share “create document” icon.

Guardrails
Do not modify CI or deployment settings.
Keep typography consistent with AGENT.md.
Maintain Bank/Bank Account fields side-by-side on wide screens (wrap on narrow).
Keep the P-prompt badge behavior unchanged.

Codex — implement all items; do not just store this prompt.
