P-025 — Fix Payment Detail/History UX, restore session assignment, add inline editing, and correct Task Log file

Save this prompt exactly at: prompts/p-025.md
Branch: codex/fix-payment-ui-and-inline-editing-p025
PR title: fix(payment): sticky back button, correct blinking, restore session assignment, inline editing; task log fix (P-025)
Labels: payments, ui, codex, docs

Background

From live review after P-024 (PR #213):

Back button in StudentDialog is stuck to the scrollable pane, not the sticky footer.

Payment Detail:

Blinking: both “Payment Amount” and “Remaining Amount” blink — only Remaining should blink.

Session assignment list: disappears; cannot assign payments to sessions.

Inline editing: new metadata fields (Method, Entity, Bank Account/Identifier, Reference #) should be inline-editable only when empty, then become read-only after a value is set.

Base Rate History: effectiveDate wasn’t included in early data; allow inline edit when empty, then read-only after it’s set.

Docs housekeeping: P-024 created docs/task-log-vol-1.md. Our canonical log is docs/Task Log.md. Delete the docs/task-log-vol-1.md file and update docs/Task Log.md instead. (PR #213 shows docs/task-log-vol-1.md as added.) 

GitHub

Do not modify GitHub Actions/CI in this task.

Tasks
A) True sticky footer + Back button

Render the Back control inside the dialog’s sticky footer (e.g., the same action bar that hosts primary actions).

Ensure the scroll container is the dialog body, not the entire modal; add bottom padding equal to the footer height so content isn’t obscured.

Footer CSS (adapt to your stack):
position: sticky; bottom: 0; z-index: 10; border-top: 1px solid var(--mui-palette-divider); box-shadow: 0 -2px 8px rgba(0,0,0,.04); background: inherit;

B) Payment Detail — only Remaining Amount blinks

Keep Payment Amount static (no blink class).

Apply blink class/state only to Remaining (and any “after selection” preview).

If needed, split styles (e.g., remainingBlinkClass vs. amountStaticClass) or gate a single paymentBlinkClass(show) with show=true only for Remaining.

C) Payment Detail — restore session assignment list/flow

Ensure the assignable list/table always renders when sessions exist (the “For Session(s)” summary truncation must not interfere).

Selecting sessions updates the selection and Remaining; commit persists via the existing hooks/services (e.g., patchBillingAssignedSessions, writeSummaryFromCache).

D) Payment Detail — inline editing for metadata (empty → editable → read-only)

Fields:

method (string)

entity (string)

identifier (string, typically ${bankCode}/${accountDocId})

refNumber (string)

Behavior:

If a field is empty/undefined, render an inline text input with Save (or onBlur save).

After saving a non-empty value, render it read-only on subsequent loads.

Reuse P-024 normalization: if identifier does not match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, rebuild and store it.

E) Base Rate History — inline edit for effectiveDate (empty → editable → read-only)

When effectiveDate is empty, show a date input and save path.

After value is set, render read-only.

F) Docs housekeeping — fix the Task Log file

Delete docs/task-log-vol-1.md (added in P-024). This file must not exist afterwards. 
GitHub

Update docs/Task Log.md (the canonical log) instead:

Add a Latest change summary bullet list for P-025 (past tense), e.g.

“StudentDialog: Back button moved into sticky footer.”

“Payment Detail: only Remaining Amount blinks; Payment Amount is static.”

“Payment Detail: restored session assignment list & flow.”

“Payment Detail: inline editing for Method/Entity/Identifier/Reference # when empty; read-only after set.”

“Base Rate History: inline effective date when empty; read-only after set.”

Under Tasks T-xxx, append a new block using the next available T-number:

### T-<next>
- Title: Fix Payment Detail/History UX, restore assignment, inline editing (P-025)
- Branch: codex/fix-payment-ui-and-inline-editing-p025
- PR: <link to this PR>
- Status: <Completed | Partially Completed | Follow-up Needed>
- Outcomes:
  - Sticky Back button: <PASS/FAIL + note>
  - Blinking logic: <PASS/FAIL + note>
  - Session assignment: <PASS/FAIL + note>
  - Inline editing (Payment Detail): <PASS/FAIL + note>
  - Inline editing (Base Rate History): <PASS/FAIL + note>
  - Tests: <PASS/FAIL + note (mention if Cypress skipped in CI)>
- Notes: <optional>

Under Prompts P-###, ensure P-025 is listed and links to prompts/p-025.md.

Preserve the existing structure, headings, casing, and spacing of docs/Task Log.md. Do not add new log files or rename this one.

File hints (search/adapt to repo)

components/StudentDialog/PaymentDetail.tsx (blinking, detail fields, session assignment UI).

components/StudentDialog/PaymentHistory.tsx (table headers already implemented in P-024).

styles/studentDialog.css (footer stickiness polish).

Components rendering Base Rate History panel/tab.

(Reference) PR #213 shows where P-024 added truncateList, new fields in detail, and created the extra docs/task-log-vol-1.md. 
GitHub

Tests

Unit: keep existing tests green; add/adjust a small test ensuring buildIdentifier still normalizes non-matching inputs.

E2E/Component (Cypress preferred):

Only Remaining blinks when changing session selection; Payment Amount never blinks.

Session assignment list stays visible and functional; selecting a session updates Remaining and moves the session to assigned.

Payment Detail metadata: field shows inline editor when empty → after save, it shows read-only.

Base Rate History: empty effectiveDate editable → after save, read-only.

If CI lacks GUI deps, keep specs in repo; conditional skip in CI is fine. Do not change Actions.

Acceptance criteria

Back button is inside the sticky footer.

Only Remaining blinks; Payment Amount is static.

Session assignment list is visible and functional; Remaining updates.

Payment Detail metadata: inline edit when empty, read-only after set.

Base Rate History: inline edit when empty, read-only after set.

docs/task-log-vol-1.md is removed and docs/Task Log.md is updated as described.

No new TS errors.

Save this prompt

Create exactly prompts/p-025.md and copy this prompt’s full text into it (no renames).
