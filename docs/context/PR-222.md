# PR #222 — Diff Summary

- **Base (target)**: `bd636d2b6e50144ba7d8e5b721bb3a1682c166b7`
- **Head (source)**: `b6ad0b1be8504033bd323a9e1de773c8a5424ee2`
- **Repo**: `girafeev1/ArtifactoftheEstablisher`

## Changed Files

```txt
M	docs/Task Log.md
R100	prompts/P-014.md	docs/archive/prompts/p-014.md
R100	prompts/P-015.md	docs/archive/prompts/p-015.md
R100	prompts/P-016.md	docs/archive/prompts/p-016.md
R100	prompts/p-017.md	docs/archive/prompts/p-017.md
R100	prompts/p-018.md	docs/archive/prompts/p-018.md
R100	prompts/P-019.md	docs/archive/prompts/p-019.md
R100	prompts/P-020.md	docs/archive/prompts/p-020.md
R100	prompts/P-021.md	docs/archive/prompts/p-021.md
R100	prompts/P-022.md	docs/archive/prompts/p-022.md
R100	prompts/P-023.md	docs/archive/prompts/p-023.md
D	prompts/P-026-01r.md
M	prompts/p-024.md
M	prompts/p-025.md
A	prompts/p-026-01r.md
M	prompts/p-026-02r.md
M	prompts/p-026-03r.md
M	prompts/p-026.md
D	prompts/p-tasklog-P-021.md
D	prompts/p-tasklog-P-023.md
D	prompts/tasklog-update-after-p025.md
D	prompts/tasklog-update-p-025.md
```

## Stats

```txt
 docs/Task Log.md                                  |  34 +--
 prompts/P-014.md => docs/archive/prompts/p-014.md |   0
 prompts/P-015.md => docs/archive/prompts/p-015.md |   0
 prompts/P-016.md => docs/archive/prompts/p-016.md |   0
 {prompts => docs/archive/prompts}/p-017.md        |   0
 {prompts => docs/archive/prompts}/p-018.md        |   0
 prompts/P-019.md => docs/archive/prompts/p-019.md |   0
 prompts/P-020.md => docs/archive/prompts/p-020.md |   0
 prompts/P-021.md => docs/archive/prompts/p-021.md |   0
 prompts/P-022.md => docs/archive/prompts/p-022.md |   0
 prompts/P-023.md => docs/archive/prompts/p-023.md |   0
 prompts/P-026-01r.md                              |  52 -----
 prompts/p-024.md                                  | 252 +++-------------------
 prompts/p-025.md                                  | 192 +++--------------
 prompts/p-026-01r.md                              |  16 ++
 prompts/p-026-02r.md                              |  80 +------
 prompts/p-026-03r.md                              |  83 ++-----
 prompts/p-026.md                                  | 138 +++---------
 prompts/p-tasklog-P-021.md                        |  26 ---
 prompts/p-tasklog-P-023.md                        |  30 ---
 prompts/tasklog-update-after-p025.md              |  61 ------
 prompts/tasklog-update-p-025.md                   |  94 --------
 22 files changed, 147 insertions(+), 911 deletions(-)
```

## Unified Diff (truncated to first 4000 lines)

```diff
diff --git a/docs/Task Log.md b/docs/Task Log.md
index 4afba9b..cb76aa6 100644
--- a/docs/Task Log.md	
+++ b/docs/Task Log.md	
@@ -4,22 +4,20 @@
 > Convention: ✅ done, ⏳ in progress, 🧭 next / planned.
 
 Latest change summary
+- Payment History (list): added “For Session(s)” column (≤5 ordinals + …) and header ellipsis polish.
+- Payment Detail: assignment area made persistent; id→ordinal map added.
+- Add Payment: when ERL is selected and codes are available, submit stamps `identifier = bankCode/accountDocId` and persists the codes.
+- Sticky footer/Back, single Remaining blink, and full cascade UI remain in progress.
 - Bank dropdown labels fall back to doc identifiers when name or code is missing.
 - Logged P-026-03r final payment UX prompt.
-- Back control sits inside sticky footers; dialog bodies pad for footer height.
-- Payment Amount remains static while Remaining uses a single blink span.
 - Session assignment table persists with zero-state and updates Remaining on selection.
-- Add Payment dialog cascades Method→Entity→Bank→Account and writes identifier, ref #, timestamp, editedBy.
 - Payment History lists “For Session(s)” with up to five ordinals then ellipsis.
 - Table headers ellipsize independently of resizable cell widths.
-- StudentDialog: Back button moved into sticky footer.
-- Payment Detail: only Remaining Amount blinks; Payment Amount is static.
 - Payment Detail: restored session assignment list & flow.
 - Payment Detail: inline editing for Method/Entity/Identifier/Reference # when empty; read-only after set.
 - Base Rate History: inline effective date when empty; read-only after set.
 - Payment History: headers finalized (Method, Entity, Bank Account, Reference #).
 - Payment Detail: 'For Session(s)' truncates to 5 with expand.
-- StudentDialog: sticky footer across tabs.
 - Identifier normalization on write; safe display with em dash.
 - Unit + e2e tests added.
 - Queued P-023: Payments metadata (method/entity/bank), header ellipsis, “For Session(s)” truncation, sticky footer, and ERL directory integration.
@@ -111,8 +109,8 @@ Tasks table — add/update:
 
 | ID    | Title                                                | State | Notes / Files |
 |-------|------------------------------------------------------|-------|---------------|
-| T-072 | Header ellipsis & width decouple (header no longer blocks narrow columns)                     | 🧭    | Table headers CSS + autosize guard |
-| T-073 | Payment History “For Session(s)” max 5 then “…”                                                | 🧭    | PaymentHistory formatter; detail-only; list pending |
+| T-072 | Header ellipsis & width decouple (header no longer blocks narrow columns)                     | ✅    | Table headers CSS + autosize guard |
+| T-073 | Payment History “For Session(s)” max 5 then “…”                                                | ✅    | PaymentHistory formatter; detail-only; list pending |
 | T-074 | Sticky dialog footer (window bottom, not scroller)                                            | ⏳    | Back lives in scroller; move into footer in P-026. |
 | T-075 | Add Payment: Method/Entity/Bank/Account/RefNumber fields + writes (timestamp, editedBy)       | 🧭    | PaymentModal, writes, types |
 | T-076 | ERL directory integration (read banks+accounts from `erl-directory`; graceful fallback)       | 🧭    | lib/erlDirectory.ts, firebase init |
@@ -195,7 +193,7 @@ Tasks table — add/update:
 | T-081 | Payment Detail blink logic: only Remaining blinks             | ⏳    | Remove duplicate span; Payment Amount static |
 | T-082 | Payment Detail: session assignment visible & robust           | ⏳    | Zero-state; selection updates Remaining; persist |
 | T-083 | Add Payment dialog cascade (Method/Entity/Bank/Account/Ref)   | ⏳    | ERL banks→accounts; identifier build; audit fields |
-| T-084 | Payment History: For Session(s) shows ≤5 then … (list view)   | ⏳    | Detail already truncates; list column to match |
+| T-084 | Payment History: For Session(s) shows ≤5 then … (list view)   | ✅    | Detail already truncates; list column to match |
 | T-085 | Column header width decouple (narrow even when header long)   | ⏳    | th ellipsis; table-layout fixed; cell widths OK |
 
 ---
@@ -204,23 +202,9 @@ Prompts table — update:
 
 | ID    | Title                                                | State | Notes |
 |-------|------------------------------------------------------|-------|-------|
-| P-026 | Finish Payment UX, Add Payment cascade, and list-view session truncation | 🧭    | See prompts/p-026.md |
-| P-025 | Fix Payment Detail/History UX, restore assignment, inline editing | 🧭    | See prompts/p-025.md |
+| P-026 | Finish Payment UX and Add Payment cascade | ⏳    | See prompts/p-026.md (revisions: p-026-01r, p-026-02r, p-026-03r) |
+| P-025 | Fix Payment Detail/History UX, restore assignment, inline editing | ⏳    | See prompts/p-025.md |
 | P-024 | Payment UI polish & data rules | ✅    | See prompts/p-024.md |
-| P-023 | Payments metadata & UI polish (headers, “For Session(s)”, sticky footer, ERL dir)     | 🧭    | See prompts/P-023.md |
-| P-021 | Loading UX, due parity, vouchers default, payment blink, base-rate UX/edit, min-width v3, calendar scan reliability | 🧭 | See prompts/P-021.md |
-| P-020 | Base Rate effectDate SSOT, summary naming/hover, card Total, min-width v2, cached.billingSummary, tests |        | Will implement T-045..T-054 |
-| P-019 | Min-width squeeze, T-217 display, payment blink logic, Base Rate history redesign         | 🧭    | This change |
-| P-018 | Context Bundle automation, payment summary write, overlay test hardening, README link fix | ✅    | This change |
-| P-017 | Task Log guardrails + finish P-016 acceptance | ✅    | This change |
-| P-016 | Autosize cols; sessions total parity; balance due source; modal stacking; base rate audit; GAS TZ/secret | 🧭    | See `prompts/p-016.md` for scope and acceptance criteria. Includes tasks T-090..T-095. |
-| P-015 | UI polish + scan hardening               | ✅    | Sticky dialog footers; thinner resize lever; per-user column widths; sticky ordinal #; infinite/darker blink on “Amount Received” (list & detail); “For Session(s)” mapping in Payment History; `/api/calendar-scan` bridged to GAS with incremental/full; spinner & toasts; removed BatchRenamePayments; Theme Popper/Menu containers pinned to `document.body`. |
-| P-011 | Calendar scan integration (Apps Script)              | ✅    | Shipped |
-| P-012 | Resizable tables + sticky # + blink polish           | ✅    | Shipped |
-| P-014 | Session totals revert, auto-size, due unification, dialog audit, base-rate history | ✅    | This change |
-| P-022 | Finish P-021 acceptance: payment blink hookup, base-rate icon move, scan status/logs, label tidy | 🧭    | See prompts/P-022.md |
-| P-025 | Fix sticky Back button; blink logic; session assignment; inline editing in Payment Detail & Base Rate History; remove `docs/task-log-vol-1.md`. | ✅ | See prompts/p-025.md |
-| P-026 | Sticky Back footer, blink polish, session assignment robustness, Add Payment cascade, history truncation, header width decouple | 🧭 | See prompts/p-026.md |
 
 
 ### Changes — P-015
diff --git a/prompts/P-014.md b/docs/archive/prompts/p-014.md
similarity index 100%
rename from prompts/P-014.md
rename to docs/archive/prompts/p-014.md
diff --git a/prompts/P-015.md b/docs/archive/prompts/p-015.md
similarity index 100%
rename from prompts/P-015.md
rename to docs/archive/prompts/p-015.md
diff --git a/prompts/P-016.md b/docs/archive/prompts/p-016.md
similarity index 100%
rename from prompts/P-016.md
rename to docs/archive/prompts/p-016.md
diff --git a/prompts/p-017.md b/docs/archive/prompts/p-017.md
similarity index 100%
rename from prompts/p-017.md
rename to docs/archive/prompts/p-017.md
diff --git a/prompts/p-018.md b/docs/archive/prompts/p-018.md
similarity index 100%
rename from prompts/p-018.md
rename to docs/archive/prompts/p-018.md
diff --git a/prompts/P-019.md b/docs/archive/prompts/p-019.md
similarity index 100%
rename from prompts/P-019.md
rename to docs/archive/prompts/p-019.md
diff --git a/prompts/P-020.md b/docs/archive/prompts/p-020.md
similarity index 100%
rename from prompts/P-020.md
rename to docs/archive/prompts/p-020.md
diff --git a/prompts/P-021.md b/docs/archive/prompts/p-021.md
similarity index 100%
rename from prompts/P-021.md
rename to docs/archive/prompts/p-021.md
diff --git a/prompts/P-022.md b/docs/archive/prompts/p-022.md
similarity index 100%
rename from prompts/P-022.md
rename to docs/archive/prompts/p-022.md
diff --git a/prompts/P-023.md b/docs/archive/prompts/p-023.md
similarity index 100%
rename from prompts/P-023.md
rename to docs/archive/prompts/p-023.md
diff --git a/prompts/P-026-01r.md b/prompts/P-026-01r.md
deleted file mode 100644
index 5b83566..0000000
--- a/prompts/P-026-01r.md
+++ /dev/null
@@ -1,52 +0,0 @@
-# Follow-up for P-026 — finish remaining Payment UX and Add Payment cascade
-
-## Do not modify CI/Actions.
-
-## A) Sticky footer & Back placement
-- Render the **Back** control inside the sticky footer bar (same container as primary actions).
-- Ensure dialog body is the scroll container; add bottom padding = footer height.
-
-## B) Remaining blink — single render
-- **Payment Amount**: never blinks.
-- **Remaining**: render once with the blink class; remove duplicate spans/elements.
-
-## C) Session assignment — always visible & functional
-- Keep the assignment table visible even when computed rows are 0 (show a zero-state).
-- Selecting/unselecting updates Remaining immediately and persists via existing hooks/services.
-
-## D) Add Payment dialog — full cascade & writes
-- **Payment Method** dropdown: `FPS`, `Bank Transfer`, `Cheque` → write `method: string`.
-- **Entity** dropdown: `Music Establish (by ERL)`, `Personal` → write `entity`.
-- If **Entity = Music Establish (by ERL)**:
-  - **Bank** dropdown: list ERL directory banks (display `{bank name} {bankCode}`; fallback `{docId} {collectionId}`).
-  - **Bank Account** dropdown: list sub-collection accounts for the bank (label = `accountType`).
-  - On submit, set **`identifier = "{bankCode}/{accountDocId}"`**.
-- **Reference Number** text input → `refNumber: string`.
-- Rename **Save** → **Submit**.
-- On submit also stamp **`timestamp`** and **`editedBy`**.
-- Reuse normalization: if manually typed `identifier` doesn’t match `/^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/`, recompute from bank+account.
-
-## E) Payment History (list) — “For Session(s)” truncation
-- Add/restore the column and display at most **5** ordinals; if more, show trailing `…` after the 5th.
-
-## F) Header width decouple
-- Ensure long headers don’t block narrow columns (e.g., `table-layout: fixed` + `th` ellipsis; keep resizable cell widths).
-
-## Tests
-- Unit: any helpers you add (session truncation, identifier build) must have basic tests.
-- Cypress/component:
-  - Only Remaining blinks; Payment Amount never blinks.
-  - Assignment table shows zero-state and updates Remaining on selection.
-  - Add Payment cascade writes `method`, `entity`, `identifier`, `refNumber`, `timestamp`, `editedBy`.
-  - Payment History list shows “For Session(s)” with ≤5 ordinals + `…`.
-
-## Acceptance
-- Back inside sticky footer; footer sticks to window edge.
-- Remaining blink fixed to single render.
-- Assignment table stable and functional.
-- Add Payment cascade implemented with identifier and audit fields.
-- List “For Session(s)” shows 5-then-ellipsis.
-- No new TS errors.
-
-## Save this prompt
-Create exactly `prompts/P-026-01r.md` with this content.
diff --git a/prompts/p-024.md b/prompts/p-024.md
index 5dc1c54..64ebda9 100644
--- a/prompts/p-024.md
+++ b/prompts/p-024.md
@@ -1,233 +1,41 @@
-P-024 — Payment UI polish & data rules (post P-023)
+# P-024 — Payment UI polish & data rules (post P-023)
 
-Goal: Finish the remaining P-023 items and add guardrails/tests so they persist:
+## Save path
+prompts/p-024.md
 
-Payment History columns/labels finalized
-
-“For Session(s)” list truncation with “(+N more)” and expand
-
-Sticky dialog footer across StudentDialog tabs
-
-Enforce identifier = "{bankCode}/{accountDocId}" at write-time (and display)
-
-Minimal unit + e2e tests
-
-MANDATORY repo hygiene
-
-Do not alter CI or GitHub Actions.
-
-Save this exact prompt to: prompts/p-024.md (lowercase, hyphenated, no extra words).
-Do not create any other prompt filename (e.g., “p-tasklog-…md”).
-
-Use a single feature branch: codex/feat-payment-ui-polish-p024.
-
-What to build
-A) Payment History table headers & new columns
-
-Update the Payment History list/table so its headers are exactly:
-
-Date
-
-Amount (currency formatted)
-
-Method (NEW)
-
-Entity (NEW) — e.g., bank/wallet name
-
-Bank Account — show the identifier (see D)
-
-Reference # — free text reference
-
-Keep columns responsive; headers must ellipsize (no wrapping).
-
-B) “For Session(s)” truncation in Payment Detail
-
-In the Payment Detail panel/modal:
-
-Show at most 5 session entries inline.
-
-If more than 5, render … (+N more) where N = total - 5.
-
-Provide a View all affordance to reveal the full list within the same panel (no navigation change).
-
-C) Sticky footer for StudentDialog panels
-
-For all StudentDialog tabs/panels with bottom actions:
-
-Make the footer sticky: position: sticky; bottom: 0; z-index: 10 with a subtle top border/shadow.
-
-Ensure the scroll container has bottom padding so content isn’t hidden under the footer.
-
-Works on small & large viewports.
-
-D) Identifier format (create + display)
-
-Define identifier as: ${bankCode}/${accountDocId}.
-
-On payment create/update:
-
-If identifier is missing but bankCode and the selected bank account document ID exist, compute and set identifier.
-
-If identifier exists but does not match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, rebuild and store it.
-
-Display:
-
-Show identifier under Bank Account in the table and detail view.
-
-If unavailable, show — (em dash). Never block rendering.
-
-E) Robustness for empties
-
-When rendering method, entity, identifier, referenceNumber, use safe fallbacks:
-
-Empty/undefined → render —.
-
-File hints (search targets; adapt to actual paths)
-
-components/StudentDialog/**/PaymentHistory*.tsx (table/list view)
-
-components/StudentDialog/**/PaymentDetail*.tsx|.ts (detail panel)
-
-components/StudentDialog/** (the panel/container that holds the footer)
-
-lib/**/payments*.ts or lib/billing/** (write path for normalization)
-
-Shared typography/cell components for header ellipsis (if present)
-
-Small helpers (add if not present)
-
-lib/payments/format.ts
-
-export function buildIdentifier(bankCode?: string, accountDocId?: string): string | undefined
-
-Return undefined if either part is missing; else ${bankCode}/${accountDocId}.
-
-lib/payments/truncate.ts
-
-export function truncateList<T>(arr: T[], limit = 5): { visible: T[]; hiddenCount: number }
-
-Tests
-
-Unit (Jest)
-
-lib/payments/format.test.ts — cases: missing parts, valid parts, regex validation.
-
-lib/payments/truncate.test.ts — arrays of length 0,1,5,6,7.
-
-E2E (Cypress)
-
-Extend/create: cypress/e2e/payment_metadata.cy.ts:
-
-Payment with ≥6 sessions: only 5 inline; shows (+N more) and expands to all.
-
-Table headers include Method, Entity, Bank Account, Reference #.
-
-Identifier text equals bankCode/accountDocId when both exist; — otherwise.
-
-If CI lacks GUI libs, keep the spec but mark it non-blocking in CI if necessary (e.g., conditional skip). Do not change CI workflow files.
-
-Acceptance criteria
-
-Payment History shows the exact headers listed above.
-
-Payment Detail truncates “For Session(s)” to 5 with … (+N more) and can reveal all.
-
-StudentDialog footer remains visible while scrolling in all tabs.
-
-Newly saved/updated payments have identifier in the specified format when inputs exist.
-
-Unit tests pass locally; Cypress spec exists and passes locally (CI may skip if headless deps are missing, but the spec must be committed).
-
-Commit plan (suggested, squash OK)
-
-feat(payment): finalize history columns (P-024 A)
-
-feat(payment-detail): truncate session list with expand (P-024 B)
-
-feat(ui): sticky footer across StudentDialog (P-024 C)
-
-feat(payments): identifier normalization + display (P-024 D)
-
-test: add unit tests for buildIdentifier + truncateList (P-024)
-
-test(e2e): payment metadata + sessions truncation (P-024)
-
-docs(task-log): update T-xxx and Latest summary for P-024
-
-Branch & PR
-
-Branch: codex/feat-payment-ui-polish-p024
-
-PR title: feat(payment): finalize history columns, truncate session list, sticky footer, identifier rule (P-024)
-
-Labels: payments, ui, codex
-
-MANDATORY — Prompt file protocol
-
-Create exactly: prompts/p-024.md
-
-Write the full text of this prompt into that file verbatim (no extra commentary, no renames).
-
-MANDATORY — Task Log maintenance (docs/task-log-vol-1.md)
-
-After implementing and running tests, update the Task Log to reflect what actually happened:
-
-Latest change summary — add a new top bullet list for P-024 with short, past-tense items, e.g.
-
-“Payment History: headers finalized (Method, Entity, Bank Account, Reference #).”
-
-“Payment Detail: ‘For Session(s)’ truncates to 5 with expand.”
-
-“StudentDialog: sticky footer across tabs.”
-
-“Identifier normalization on write; safe display with em dash.”
-
-“Unit + e2e tests added.”
-
-Tasks T-xxx — append a new task block using the next available task id. Use this template and fill in status based on results (✅ / ⚠️ / ❌):
-
-### T-<next>
-- Title: Payment UI polish & data rules (P-024)
+## Branch & PR
 - Branch: codex/feat-payment-ui-polish-p024
-- PR: <link to this PR>
-- Status: <Completed | Partially Completed | Follow-up Needed>
-- Outcomes:
-  - A) History headers: <PASS/FAIL + 1-line note>
-  - B) Sessions truncation: <PASS/FAIL + 1-line note>
-  - C) Sticky footer: <PASS/FAIL + 1-line note>
-  - D) Identifier rule: <PASS/FAIL + 1-line note>
-  - E) Tests: <PASS/FAIL + 1-line note (mention if Cypress skipped in CI)>
-- Notes: <optional short notes or TODOs>
-
-
-Prompts P-### — add an entry for P-024 with a link to prompts/p-024.md and this PR.
-
-If docs/task-log-vol-1.md does not exist, create it with headings:
-
-“Latest change summary”
-
-“Tasks T-xxx”
-
-“Prompts P-###”
-
-Save Task Log changes in a separate commit titled:
-
-docs(task-log): update Latest, T-<next>, and P-024
-
-Definition of Done (self-checklist)
+- PR title: feat(payment): finalize history columns, truncate session list, sticky footer scaffolding, identifier rule (P-024)
+- Labels: payments, ui, codex
 
- Headers: Method, Entity, Bank Account, Reference # present and responsive
+## Goals
+1) Payment History: headers/columns finalized  
+2) Payment Detail: “For Session(s)” truncation with expand  
+3) Sticky footer scaffolding for StudentDialog  
+4) Enforce identifier = "{bankCode}/{accountDocId}" on write + display  
+5) Minimal unit + e2e tests
 
- “For Session(s)” truncation + expand works
+## Implement
+A) **Payment History headers/columns**
+- Columns = Date, Amount (currency), Method (NEW), Entity (NEW), Bank Account (identifier), Reference #.
+- Headers ellipsize; cells responsive.
 
- Sticky footer in StudentDialog everywhere
+B) **Payment Detail truncation**
+- Show ≤5 sessions inline, then “(+N more)” with View all/Hide.
 
- Identifier built and shown; safe fallback —
+C) **Sticky footer scaffolding**
+- Add footer container intended to be sticky (full stickiness finished in later prompt).
 
- Unit tests for buildIdentifier and truncateList
+D) **Identifier rule**
+- On create/update: if identifier missing or not matching `/^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/`, set to `${bankCode}/${accountDocId}` when both parts exist.
+- Display identifier in list & detail; fallback “—”.
 
- Cypress spec added/updated
+E) **Robustness**
+- For method/entity/identifier/refNumber: render “—” when empty.
 
- prompts/p-024.md written verbatim
+## Tests
+- Unit: `buildIdentifier`, `truncateList`.
+- E2E (can be skipped in CI): verify headers, truncation, and identifier display.
 
- docs/task-log-vol-1.md updated per “Task Log maintenance”
+## Acceptance
+- Columns present as above; truncation works; sticky footer scaffolding added; identifier enforced/displays; tests included. 
diff --git a/prompts/p-025.md b/prompts/p-025.md
index a7f0b86..cf5adf6 100644
--- a/prompts/p-025.md
+++ b/prompts/p-025.md
@@ -1,166 +1,32 @@
-P-025 — Fix Payment Detail/History UX, restore session assignment, add inline editing, and correct Task Log file
+# P-025 — Fix Payment Detail/History UX, restore session assignment, add inline editing, and remove stray task log
 
-Save this prompt exactly at: prompts/p-025.md
-Branch: codex/fix-payment-ui-and-inline-editing-p025
-PR title: fix(payment): sticky back button, correct blinking, restore session assignment, inline editing; task log fix (P-025)
-Labels: payments, ui, codex, docs
+## Save path
+prompts/p-025.md
 
-Background
-
-From live review after P-024 (PR #213):
-
-Back button in StudentDialog is stuck to the scrollable pane, not the sticky footer.
-
-Payment Detail:
-
-Blinking: both “Payment Amount” and “Remaining Amount” blink — only Remaining should blink.
-
-Session assignment list: disappears; cannot assign payments to sessions.
-
-Inline editing: new metadata fields (Method, Entity, Bank Account/Identifier, Reference #) should be inline-editable only when empty, then become read-only after a value is set.
-
-Base Rate History: effectiveDate wasn’t included in early data; allow inline edit when empty, then read-only after it’s set.
-
-Docs housekeeping: P-024 created docs/task-log-vol-1.md. Our canonical log is docs/Task Log.md. Delete the docs/task-log-vol-1.md file and update docs/Task Log.md instead. (PR #213 shows docs/task-log-vol-1.md as added.) 
-
-GitHub
-
-Do not modify GitHub Actions/CI in this task.
-
-Tasks
-A) True sticky footer + Back button
-
-Render the Back control inside the dialog’s sticky footer (e.g., the same action bar that hosts primary actions).
-
-Ensure the scroll container is the dialog body, not the entire modal; add bottom padding equal to the footer height so content isn’t obscured.
-
-Footer CSS (adapt to your stack):
-position: sticky; bottom: 0; z-index: 10; border-top: 1px solid var(--mui-palette-divider); box-shadow: 0 -2px 8px rgba(0,0,0,.04); background: inherit;
-
-B) Payment Detail — only Remaining Amount blinks
-
-Keep Payment Amount static (no blink class).
-
-Apply blink class/state only to Remaining (and any “after selection” preview).
-
-If needed, split styles (e.g., remainingBlinkClass vs. amountStaticClass) or gate a single paymentBlinkClass(show) with show=true only for Remaining.
-
-C) Payment Detail — restore session assignment list/flow
-
-Ensure the assignable list/table always renders when sessions exist (the “For Session(s)” summary truncation must not interfere).
-
-Selecting sessions updates the selection and Remaining; commit persists via the existing hooks/services (e.g., patchBillingAssignedSessions, writeSummaryFromCache).
-
-D) Payment Detail — inline editing for metadata (empty → editable → read-only)
-
-Fields:
-
-method (string)
-
-entity (string)
-
-identifier (string, typically ${bankCode}/${accountDocId})
-
-refNumber (string)
-
-Behavior:
-
-If a field is empty/undefined, render an inline text input with Save (or onBlur save).
-
-After saving a non-empty value, render it read-only on subsequent loads.
-
-Reuse P-024 normalization: if identifier does not match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, rebuild and store it.
-
-E) Base Rate History — inline edit for effectiveDate (empty → editable → read-only)
-
-When effectiveDate is empty, show a date input and save path.
-
-After value is set, render read-only.
-
-F) Docs housekeeping — fix the Task Log file
-
-Delete docs/task-log-vol-1.md (added in P-024). This file must not exist afterwards. 
-GitHub
-
-Update docs/Task Log.md (the canonical log) instead:
-
-Add a Latest change summary bullet list for P-025 (past tense), e.g.
-
-“StudentDialog: Back button moved into sticky footer.”
-
-“Payment Detail: only Remaining Amount blinks; Payment Amount is static.”
-
-“Payment Detail: restored session assignment list & flow.”
-
-“Payment Detail: inline editing for Method/Entity/Identifier/Reference # when empty; read-only after set.”
-
-“Base Rate History: inline effective date when empty; read-only after set.”
-
-Under Tasks T-xxx, append a new block using the next available T-number:
-
-### T-<next>
-- Title: Fix Payment Detail/History UX, restore assignment, inline editing (P-025)
+## Branch & PR
 - Branch: codex/fix-payment-ui-and-inline-editing-p025
-- PR: <link to this PR>
-- Status: <Completed | Partially Completed | Follow-up Needed>
-- Outcomes:
-  - Sticky Back button: <PASS/FAIL + note>
-  - Blinking logic: <PASS/FAIL + note>
-  - Session assignment: <PASS/FAIL + note>
-  - Inline editing (Payment Detail): <PASS/FAIL + note>
-  - Inline editing (Base Rate History): <PASS/FAIL + note>
-  - Tests: <PASS/FAIL + note (mention if Cypress skipped in CI)>
-- Notes: <optional>
-
-Under Prompts P-###, ensure P-025 is listed and links to prompts/p-025.md.
-
-Preserve the existing structure, headings, casing, and spacing of docs/Task Log.md. Do not add new log files or rename this one.
-
-File hints (search/adapt to repo)
-
-components/StudentDialog/PaymentDetail.tsx (blinking, detail fields, session assignment UI).
-
-components/StudentDialog/PaymentHistory.tsx (table headers already implemented in P-024).
-
-styles/studentDialog.css (footer stickiness polish).
-
-Components rendering Base Rate History panel/tab.
-
-(Reference) PR #213 shows where P-024 added truncateList, new fields in detail, and created the extra docs/task-log-vol-1.md. 
-GitHub
-
-Tests
-
-Unit: keep existing tests green; add/adjust a small test ensuring buildIdentifier still normalizes non-matching inputs.
-
-E2E/Component (Cypress preferred):
-
-Only Remaining blinks when changing session selection; Payment Amount never blinks.
-
-Session assignment list stays visible and functional; selecting a session updates Remaining and moves the session to assigned.
-
-Payment Detail metadata: field shows inline editor when empty → after save, it shows read-only.
-
-Base Rate History: empty effectiveDate editable → after save, read-only.
-
-If CI lacks GUI deps, keep specs in repo; conditional skip in CI is fine. Do not change Actions.
-
-Acceptance criteria
-
-Back button is inside the sticky footer.
-
-Only Remaining blinks; Payment Amount is static.
-
-Session assignment list is visible and functional; Remaining updates.
-
-Payment Detail metadata: inline edit when empty, read-only after set.
-
-Base Rate History: inline edit when empty, read-only after set.
-
-docs/task-log-vol-1.md is removed and docs/Task Log.md is updated as described.
-
-No new TS errors.
-
-Save this prompt
-
-Create exactly prompts/p-025.md and copy this prompt’s full text into it (no renames).
+- PR title: fix(payment): sticky footer Back, correct blinking, restore session assignment, inline editing; remove docs/task-log-vol-1.md (P-025)
+- Labels: payments, ui, codex, docs
+
+## Goals
+1) Back button belongs to sticky footer  
+2) Payment Detail: only Remaining blinks  
+3) Session assignment list always visible & functional  
+4) Inline editing (Payment Detail) for empty fields → read-only after set  
+5) Base Rate History: inline effectiveDate when empty → read-only  
+6) Remove `docs/task-log-vol-1.md` (canonical is `docs/Task Log.md`)
+
+## Implement
+A) **Back in sticky footer** (move control into footer bar; body gets bottom padding).
+B) **Blinking**: Payment Amount static; Remaining uses blink class once.
+C) **Assignment**: persistent shell with zero-state; selection updates Remaining; persist as today.
+D) **Inline editing**: method/entity/identifier/refNumber editable only when empty; after save, read-only; reuse identifier normalization.
+E) **Base Rate History**: if effectiveDate empty, allow inline edit; then read-only.
+F) **Docs**: delete `docs/task-log-vol-1.md`.
+
+## Tests
+- Unit: identifier normalization.
+- E2E: Remaining blinks only; assignment works; inline edit flows.
+
+## Acceptance
+- Back in sticky footer; single Remaining blink; assignment stable; inline-on-empty works; base rate date edit works; stray log removed.
diff --git a/prompts/p-026-01r.md b/prompts/p-026-01r.md
new file mode 100644
index 0000000..4e5540a
--- /dev/null
+++ b/prompts/p-026-01r.md
@@ -0,0 +1,16 @@
+# P-026-01r — Partial delivery toward P-026
+
+## Save path
+prompts/p-026-01r.md
+
+## Scope
+- Implement list-view “For Session(s)” column (≤5 + “…”).  
+- Make assignment area persistent (no disappear on empty).  
+- Submit-time stamping: when ERL selected and `bankCode` + `accountDocId` available, set `identifier = "{bankCode}/{accountDocId}"`.  
+- Header ellipsis polish in PaymentHistory.
+
+## Out of scope
+- Sticky Back; single Remaining blink; full cascade UI — to later revisions.
+
+## Acceptance
+- List column present with truncation; assignment container persists; identifier stamping occurs on submit when ERL; headers ellipsize.
diff --git a/prompts/p-026-02r.md b/prompts/p-026-02r.md
index 8f31f24..b430a6a 100644
--- a/prompts/p-026-02r.md
+++ b/prompts/p-026-02r.md
@@ -1,72 +1,14 @@
-P-026-02r — Finalize Payment UX + Add Payment cascade
+# P-026-02r — Continue P-026: sticky Back, single Remaining blink, stable assignment, cascade UI
 
-## Rules
-- Do NOT modify CI/workflows. (Deploy gating handled separately.)
-- Keep changes minimal, typed, and within existing components.
+## Save path
+prompts/p-026-02r.md
 
-## A) Sticky footer + Back placement
-- Render the Back control INSIDE the dialog’s sticky footer/action bar (same region as primary actions).
-- Ensure the dialog BODY is the scroll container; add bottom padding equal to the footer height so content isn’t hidden.
-- Footer CSS (adapt to stack):
-  position: sticky; bottom: 0; z-index: 10;
-  border-top: 1px solid var(--mui-palette-divider);
-  box-shadow: 0 -2px 8px rgba(0,0,0,.04);
-  background: inherit;
+## Scope
+- Back inside sticky footer; body padding.  
+- Remaining blink single element; remove duplicate render.  
+- Assignment list always visible with zero-state; selection updates Remaining; persist.  
+- Add Payment cascade UI (Entity → Bank → Bank Account) with writes and identifier/audit stamping.  
+- List “For Session(s)” present (≤5 + “…” ) and header ellipsis intact.
 
-## B) Remaining blink — single render only
-- Payment Amount: never blinks.
-- Remaining: render ONCE with the blink class. Remove any duplicate span/element causing double or flicker.
-
-## C) Session assignment list — always visible & functional
-- Keep the assignment section visible even when computed rows are 0 (show a zero-state).
-- Selecting/unselecting sessions updates Remaining immediately and persists via existing hooks/services.
-- The “For Session(s)” summary (detail view) MUST NOT hide or replace the assignment controls.
-
-## D) Add Payment dialog — cascade + writes
-Implement the full cascade as previously specified:
-
-1) Payment Method dropdown: FPS, Bank Transfer, Cheque → write method: string.
-2) Entity dropdown: Music Establish (by ERL), Personal → write entity.
-3) If Entity = Music Establish (by ERL):
-   - Bank dropdown: list ERL directory banks; label each as {bankName} {bankCode} (fallback {docId} {collectionId} if needed).
-   - Bank Account dropdown: for the chosen bank, list sub-collection accounts; label with each account’s accountType.
-   - On submit, set identifier = "{bankCode}/{accountDocId}".
-4) Reference Number input → write refNumber: string.
-5) Rename Save → Submit.
-6) On submit also stamp timestamp and editedBy.
-7) Normalization: if user-entered identifier does not match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, recompute from {bankCode}/{accountDocId}.
-
-## E) Payment History (list view) — “For Session(s)” column
-- Ensure the column exists in the list view and displays up to 5 session ordinals; if more, append a trailing … after the 5th.
-- Keep cell/headers ellipsized; no header should block narrowing.
-
-## F) Header width decouple
-- Make sure long headers don’t prevent narrow columns:
-  - table-layout: fixed where appropriate
-  - th, .table-header with overflow: hidden; text-overflow: ellipsis; white-space: nowrap
-  - Retain resizable data cell widths.
-
-## Tests
-- Unit: helpers for session truncation and identifier build/normalize.
-- Cypress / component:
-  - Only Remaining blinks; Payment Amount static.
-  - Assignment table shows zero-state and updates Remaining on selection.
-  - Add Payment cascade: pick Entity=ERL → Bank → Bank Account → Submit; verify method, entity, identifier, refNumber, timestamp, editedBy.
-  - Payment History (list): For Session(s) shows ≤5 ordinals with trailing ….
-
-> CI may skip Cypress due to headless deps; keep specs committed and guard with conditional skip if needed. Do NOT edit workflows.
-
-## Acceptance
-- Back sits in sticky footer; footer sticks to window edge.
-- Remaining blink uses a single element; no flicker/double.
-- Assignment section remains visible and functional.
-- Add Payment cascade fully implemented; identifier & audit fields written.
-- List “For Session(s)” shows 5-then-ellipsis.
-- No new TypeScript errors.
-
-## Save this prompt
-Create prompts/p-026-02r.md with this content.
-## Branch & PR
-- Branch: codex/finalize-payment-ux-and-functionality-enhancements-02r
-- PR title: feat(payment): finalize sticky footer, remaining blink, assignment, Add Payment cascade, list truncation (P-026-02r)
-- Labels: payments, ui, codex
+## Tests & Acceptance
+- Same as P-026; incremental changes pass locally; no CI edits.
diff --git a/prompts/p-026-03r.md b/prompts/p-026-03r.md
index b0316e3..0f68c96 100644
--- a/prompts/p-026-03r.md
+++ b/prompts/p-026-03r.md
@@ -1,82 +1,37 @@
 # P-026-03r — Finish Payment UX and Add Payment cascade (final touches)
 
-## Save this prompt exactly at
+## Save path
 prompts/p-026-03r.md
 
 ## Branch & PR
 - Branch: codex/finalize-payment-ux-and-functionality-enhancements-03r
-- PR title: feat(payment): finish sticky Back, single remaining blink, stable assignment, Add Payment cascade, list “For Session(s)” truncation (P-026-03r)
+- PR title: feat(payment): finish sticky Back, single remaining blink, stable assignment, Add Payment cascade, list truncation (P-026-03r)
 - Labels: payments, ui, codex
 
 ## Rules
-- Do NOT modify CI or any GitHub Actions.
-- Keep changes minimal, typed, and in existing components.
+- Do NOT modify CI or GitHub Actions.
 
----
+## A) Sticky footer + Back
+- Place Back inside sticky footer/action bar; body is scroll container; add bottom padding.
 
-## A) Sticky footer + Back placement
-- Render the **Back** control INSIDE the dialog’s **sticky footer/action bar** (same container as primary actions).
-- Ensure the dialog **body** is the scroll container; add bottom padding equal to footer height so content isn’t hidden.
-- Footer CSS (adapt to stack):
-  - position: sticky; bottom: 0; z-index: 10;
-  - border-top: 1px solid var(--mui-palette-divider);
-  - box-shadow: 0 -2px 8px rgba(0,0,0,.04);
-  - background: inherit;
+## B) Remaining blink — single render
+- Payment Amount never blinks; Remaining renders once with blink class.
 
-## B) Remaining blink — single render only
-- **Payment Amount**: never blinks.
-- **Remaining**: render **once** with the blink class; **remove any duplicate span/element** that causes flicker/double-blink.
+## C) Assignment list
+- Persisted shell with zero-state; selection updates Remaining; writes persist.
 
-## C) Session assignment list — always visible & functional
-- Keep the assignment section visible even when computed rows are 0 (show a zero-state).
-- Selecting/unselecting sessions updates **Remaining** immediately and persists via existing hooks/services.
-- The “For Session(s)” summary in the **detail view** must NOT hide or replace the assignment controls.
+## D) Add Payment cascade
+- Method: FPS, Bank Transfer, Cheque → `method`.
+- Entity: Music Establish (ERL), Personal → `entity`.
+- If ERL: Bank (label `{bankName} {bankCode}`; fallback `{docId} {collectionId}`;), Bank Account (label `accountType`).
+- On Submit: `identifier = "{bankCode}/{accountDocId}"`, plus `timestamp` & `editedBy`; recompute identifier if regex fails.
 
-## D) Add Payment dialog — cascade + writes (the big missing piece)
-Implement the full cascade exactly:
-
-1) **Payment Method** (dropdown): `FPS`, `Bank Transfer`, `Cheque` → store `method: string`.
-2) **Entity** (dropdown): `Music Establish (ERL)`, `Personal` → store `entity: string` (use the label).
-3) If **Entity = "Music Establish (ERL)"**:
-   - **Bank** dropdown: list ERL directory banks. Display label = `{bankName} {bankCode}` (fallback `{docId} {collectionId}` if needed).
-   - **Bank Account** dropdown: for the chosen bank, list sub-collection accounts; label with each account’s **`accountType`**.
-   - On submit, set **`identifier = "{bankCode}/{accountDocId}"`** (accountDocId = selected account document id).
-4) **Reference Number** (text) → store `refNumber: string`.
-5) Rename **Save** → **Submit**.
-6) On submit also stamp **`timestamp`** and **`editedBy`**.
-7) Normalization: if a user-entered `identifier` does not match `/^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/`, recompute from `{bankCode}/{accountDocId}` before write.
-
-> Data access: use the existing ERL directory reader if present; otherwise add a tiny `lib/erlDirectory.ts` that fetches banks + accounts from the ERL directory database with graceful fallback (both `banks/{bankCode}` and `bankAccount/{bankCode}/accounts/*` shapes acceptable). No secrets in code.
-
-## E) Payment History (list) — “For Session(s)” column
-- Ensure the column exists and shows up to **5** session ordinals; if more, append a trailing **`…`** after the 5th (no count here; detail already shows `(+N more)`).
-
-## F) Header width decouple (so long headers don’t block narrowing)
-- Apply `table-layout: fixed` where appropriate.
-- Ensure `th`/header cells have: `overflow: hidden; text-overflow: ellipsis; white-space: nowrap`.
-- Keep data cells resizable as today.
-
----
+## E) List “For Session(s)”
+- Show ≤5 ordinals, then trailing “…”; headers ellipsize; cells resizable.
 
 ## Tests
-- **Unit:** helpers for session truncation and identifier build/normalize.
-- **Cypress / component:**
-  - Only Remaining blinks; Payment Amount is static.
-  - Assignment table shows zero-state and updates Remaining on selection.
-  - Add Payment cascade: pick Entity=ERL → Bank → Bank Account → Submit; verify `method`, `entity`, `identifier`, `refNumber`, `timestamp`, `editedBy`.
-  - Payment History list shows “For Session(s)” with ≤5 ordinals + `…`.
-
-> CI may skip Cypress due to headless deps; keep specs committed and guard with conditional skip if needed. Do NOT edit workflows.
-
----
+- Unit: identifier + truncation helpers.  
+- Cypress: remaining blink, assignment, cascade write, list truncation.
 
 ## Acceptance
-- Back sits in the sticky footer; footer sticks to the window edge.
-- Remaining uses a **single** blinking element (no duplicates).
-- Assignment section remains visible and functional end-to-end.
-- Add Payment cascade implemented; `identifier` and audit fields written.
-- List “For Session(s)” shows 5-then-ellipsis.
-- No new TypeScript errors.
-
-## Save this prompt
-Write this file to **prompts/p-026-03r.md** verbatim (no renames).
+- All items A–E visible in UI; no TS errors.
diff --git a/prompts/p-026.md b/prompts/p-026.md
index d68dcd7..02171ef 100644
--- a/prompts/p-026.md
+++ b/prompts/p-026.md
@@ -1,105 +1,33 @@
-P-026 — Finish Payment UX, Add Payment cascade, and list-view session truncation
-
-Save this prompt exactly at: prompts/p-026.md
-Branch: codex/finish-payment-ux-and-add-payment-cascade-p026
-PR title: feat(payment): finalize sticky footer, remaining blink, session assignment, Add Payment cascade, and history session truncation (P-026)
-Labels: payments, ui, codex
-
-Background (post P-024, P-025)
-
-P-024/P-025 shipped new Payment History columns and inline-when-empty editing in the detail view; Remaining/Amount blink logic still needs polishing, and the Back button wasn’t reliably inside the sticky footer in your live test. PR #214 shows edits to PaymentDetail.tsx, PaymentHistory.tsx, BaseRateHistoryDialog.tsx, etc., plus updates to docs/Task Log.md. 
-GitHub
-
-Do not modify any GitHub Actions/CI in this task.
-
-Tasks
-A) Sticky footer & Back placement
-
-Render the Back control inside the sticky footer (same bar as action buttons).
-
-Ensure the scroll container is the dialog body; add bottom padding equal to footer height so content is never hidden.
-
-Footer CSS (adapt to your stack):
-position: sticky; bottom: 0; z-index: 10; border-top: 1px solid var(--mui-palette-divider); box-shadow: 0 -2px 8px rgba(0,0,0,.04); background: inherit;
-
-B) Remaining blink — single source of truth
-
-Ensure Payment Amount is static (no blink).
-
-Ensure Remaining uses the blink class once (no duplicate spans). Remove the second, duplicate rendering that causes flicker. (P-025 currently renders the value twice — fix to one element with the correct class.)
-
-C) Session assignment list — always visible & functional
-
-Keep the assignment table visible even when the computed rows are temporarily 0 (show a zero-state).
-
-Selecting/unselecting sessions updates Remaining and persists via existing hooks/services; the list never disappears due to transient data states.
-
-D) Add Payment dialog — cascade & writes
-
-Implement the full cascade and writes exactly as specified earlier:
-
-Payment Method — dropdown with: FPS, Bank Transfer, Cheque → save to method: string.
-
-Entity — dropdown: Music Establish (by ERL) or Personal → save to entity.
-
-If Entity = Music Establish (by ERL):
-
-Bank dropdown: list banks from your ERL directory DB (e.g., erl-directory database). Show each tab as {bank name} {bankCode} (fallback label: {documentId} {collectionId} if needed).
-
-Bank Account dropdown: for the chosen bank, list sub-collection accounts; label with each account’s accountType (your internal account identifier).
-
-On submit, set identifier = "{bankCode}/{accountDocId}".
-
-Reference Number — free text → refNumber: string.
-
-Rename Save to Submit.
-
-On submit, also stamp timestamp and editedBy.
-
-Reuse the normalization from P-024: if a typed identifier doesn’t match /^[0-9A-Za-z]+\/[0-9A-Za-z_-]+$/, recompute from bankCode + accountDocId.
-
-E) Payment History (list view): For Session(s) truncation
-
-Add the “For Session(s)” column in the list view (if removed/hidden), display up to 5 session ordinals; if more, show … after the 5th (no count needed here; detail view already has (+N more)).
-
-Cells ellipsize; no column header should prevent narrowing.
-
-F) Column header width decouple
-
-Ensure header text can ellipsize independently of cell contents so narrow columns are possible even when headers are long (e.g., set table-layout: fixed, apply overflow: hidden; text-overflow: ellipsis; white-space: nowrap to th while cell widths remain resizable).
-
-Tests
-
-Unit: keep current tests green; if you add small helpers (e.g., for session truncation), test them.
-
-E2E/Component (Cypress):
-
-Only Remaining blinks when changing selected sessions; Payment Amount never blinks.
-
-Session assignment table is visible on empty/zero states and updates Remaining on selection.
-
-Add Payment cascade:
-
-Choose Method, Entity=ERL, pick Bank → Bank Account → Submit; verify method, entity, identifier, refNumber, and audit fields (timestamp, editedBy) are written.
-
-Payment History list shows For Session(s) with at most 5 ordinals and … when longer.
-
-If CI lacks GUI deps, keep specs committed; conditional skip in CI is fine. Do not touch Actions.
-
-Acceptance criteria
-
-Back button sits inside the sticky footer; footer sticks to the window edge, not the scroller.
-
-Remaining blinks correctly; no duplicate span/render.
-
-Session assignment list stays visible with a zero-state and works end-to-end.
-
-Add Payment cascade works; identifier stored as {bankCode}/{accountDocId}; audit fields recorded.
-
-Payment History shows “For Session(s)” with 5-then-ellipsis.
-
-No new TS errors.
-
-Save this prompt
-
-Create exactly prompts/p-026.md and copy this prompt’s full text into it (no renames).
+# P-026 — Finish Payment UX and Add Payment cascade
+
+## Save path
+prompts/p-026.md
+
+## Branch & PR
+- Branch: codex/finish-payment-ux-and-add-payment-cascade-p026
+- PR title: feat(payment): finalize sticky Back, single Remaining blink, stable assignment, Add Payment cascade, list “For Session(s)” truncation (P-026)
+- Labels: payments, ui, codex
+
+## Goals
+A) Sticky Back inside sticky footer  
+B) Remaining blink = single element  
+C) Assignment section always visible & functional  
+D) Add Payment cascade (Entity → Bank → Bank Account) + writes  
+E) Payment History list: “For Session(s)” ≤5 then “…”  
+F) Header width decouple (headers ellipsize)
+
+## Implement
+- **Add Payment**:
+  - Method dropdown: FPS, Bank Transfer, Cheque → `method`.
+  - Entity dropdown: Music Establish (ERL), Personal → `entity`.
+  - If ERL: Bank dropdown from ERL directory (label `{bankName} {bankCode}`; fallback `{docId} {collectionId}`), Bank Account dropdown (label `accountType`).
+  - On Submit: `identifier = "{bankCode}/{accountDocId}"`, plus stamp `timestamp` & `editedBy`.
+  - If user entered identifier doesn’t match regex, recompute.
+- **Detail & List** per goals above.
+
+## Tests
+- Unit: helpers for identifier + session truncation.
+- E2E: single Remaining blink; assignment flow; cascade writes; list “For Session(s)” truncation.
+
+## Acceptance
+- All goals A–F met; no new TS errors.
diff --git a/prompts/p-tasklog-P-021.md b/prompts/p-tasklog-P-021.md
deleted file mode 100644
index 7d8aef2..0000000
--- a/prompts/p-tasklog-P-021.md
+++ /dev/null
@@ -1,26 +0,0 @@
-Prompt — Task Log update for P-021
-•Append the following to the top of “Tasks table — add/update”:
-
-| ID    | Title                                                                    | State | Notes / Files |
-|-------|--------------------------------------------------------------------------|-------|---------------|
-| T-055 | Loading UX: spinner→blinking “–” in value (respect reduced-motion)       | 🧭    | OverviewTab & other fields; remove label spinners |
-| T-056 | Card Due parity & loading fallback                                       | 🧭    | Prefer cached.billingSummary; show “–” while loading |
-| T-057 | Sessions: “Session Vouchers” column hidden by default (persist per user) | 🧭    | SessionsTab columns/filters |
-| T-058 | Payment History blink: yellow (remaining>0), red (< minUnpaidRate)       | 🧭    | PaymentHistory; minUnpaidRate util; a11y fallback |
-| T-059 | Base Rate info icon relocation (Billing tab Base Rate field)             | 🧭    | Move from Session Detail to Billing tab |
-| T-060 | Base Rate History: footer Add, sub-dialog (Rate+Effective Date), editing | 🧭    | Inline fix for missing effectDate; keep tooltips/currency |
-| T-061 | Column min-width v3 (~24–26px) + ellipsis + keyboard resize              | 🧭    | useColumnWidths + cell styles |
-| T-062 | Calendar scan UX: error surfacing & logs (incremental/full)              | 🧭    | /api/calendar-scan + UI toasts + ScanLogs |
-| T-063 | Calendar delete/cancel propagation & 410 full-resync fallback            | 🧭    | GAS sync + session updates |
-| T-064 | Scan status caption in Tools menu (last run, result)                      | 🧭    | Small status text; optional link to logs |
-| T-065 | Tests: blink logic, base-rate effectDate, min-width keyboard             | 🧭    | Unit + Cypress |
-
-•In Prompts table — update, append:
-
-| P-021 | Loading UX, due parity, vouchers default, payment blink, base-rate UX/edit, min-width v3, calendar scan reliability | 🧭 | See prompts/P-021.md |
-
-•In Latest change summary, add one bullet:
-
-- Queue P-021: loading UX cleanup, due parity, vouchers default, payment blink, base-rate history editing, min-width v3, calendar scan fixes.
-
-(Keep the file append-only per our CI guard.)
diff --git a/prompts/p-tasklog-P-023.md b/prompts/p-tasklog-P-023.md
deleted file mode 100644
index c45e3f7..0000000
--- a/prompts/p-tasklog-P-023.md
+++ /dev/null
@@ -1,30 +0,0 @@
-Prompt — Task Log update for P-022 & queue P-023
-
-1) Latest change summary — append:
-- Queued P-023: Payments metadata (method/entity/bank), header ellipsis, “For Session(s)” truncation, sticky footer, and ERL directory integration.
-
-2) Tasks table — add/update (append these rows at the top):
-| ID    | Title                                                                                         | State | Notes / Files |
-|-------|-----------------------------------------------------------------------------------------------|-------|---------------|
-| T-072 | Header ellipsis & width decouple (header no longer blocks narrow columns)                     | 🧭    | Table headers CSS + autosize guard |
-| T-073 | Payment History “For Session(s)” max 5 then “…”                                                | 🧭    | PaymentHistory formatter |
-| T-074 | Sticky dialog footer (window bottom, not scroller)                                            | 🧭    | FloatingWindow/Dialog layout, CSS |
-| T-075 | Add Payment: Method/Entity/Bank/Account/RefNumber fields + writes (timestamp, editedBy)       | 🧭    | PaymentModal, writes, types |
-| T-076 | ERL directory integration (read banks+accounts from `erl-directory`; graceful fallback)       | 🧭    | lib/erlDirectory.ts, firebase init |
-| T-077 | Payment list: rename columns; add Method & Entity                                             | 🧭    | PaymentHistory.tsx |
-| T-078 | Payment detail: two-column summary layout                                                     | 🧭    | PaymentDetail.tsx, styles |
-| T-079 | Tests: formatters, identifier write guard, sticky footer, Add Payment flow                    | 🧭    | unit + e2e |
-
-3) Close/advance P-022 items based on the last PR:
-- T-066 — Payment blink hookup (list & detail): ✅
-- T-069 — ScanLogs storage (last 20 runs): ✅
-- T-070 — Label consistency “Joined Date”: ✅
-- T-068 — Calendar scan toast + last-scan caption: ⏳ (caption landed; keep until toast verified everywhere)
-- T-067 — Move Base Rate info icon to Billing tab: 🧭 (still to do)
-
-4) Prompts table — append:
-| ID    | Title                                                                                  | State | Notes |
-|-------|----------------------------------------------------------------------------------------|-------|-------|
-| P-023 | Payments metadata & UI polish (headers, “For Session(s)”, sticky footer, ERL dir)     | 🧭    | See prompts/P-023.md |
-
-(Ensure all insertions are at the **top** of their respective sections.)
diff --git a/prompts/tasklog-update-after-p025.md b/prompts/tasklog-update-after-p025.md
deleted file mode 100644
index fcfa8c3..0000000
--- a/prompts/tasklog-update-after-p025.md
+++ /dev/null
@@ -1,61 +0,0 @@
-Update Task Log based on P-024 & P-025, and queue P-026
-
-Save this prompt at: prompts/tasklog-update-after-p025.md
-Branch: codex/docs-task-log-update-after-p025
-PR title: docs(task-log): reflect P-024/P-025 outcomes; queue P-026
-Labels: docs, codex
-
-Context (facts to reflect)
-
-P-024 & P-025 merged with substantial Payment UI work; PR #214’s Context Bundle shows the changed files and that both prompts/p-024.md and prompts/p-025.md are present; docs/Task Log.md was updated there. Ensure the canonical log remains docs/Task Log.md (no docs/task-log-vol-1.md).
-
-What to change in docs/Task Log.md
-
-Latest change summary — add new bullets (append-only, keep existing bullets):
-
-Payment History: headers finalized (Method, Entity, Bank Account, Reference #); two-column detail shows identifier & reference with safe fallbacks. 
-
-Payment Detail: “For Session(s)” truncation with View all/Hide; inline edit when empty for metadata; added tests & helpers. 
-
-Sticky footer scaffolding present; Back must be anchored inside footer (queued for P-026).
-
-Remaining blink polish & session assignment table robustness queued for P-026.
-
-Tasks table — add/update
-
-Mark complete (✅) any rows that P-024/P-025 actually delivered (e.g., history columns / detail fields), keep sticky footer as ⏳ with a note (“Back lives in scroller; move into footer in P-026”), and leave history “For Session(s)” column truncation as 🧭 if still pending in list view.
-
-Add new P-026 follow-ups at the end with next T-IDs:
-
-| T-<next>   | StudentDialog Back button inside sticky footer                | ⏳ | Move Back into footer bar; body gets bottom padding |
-| T-<next+1> | Payment Detail blink logic: only Remaining blinks             | ⏳ | Remove duplicate span; Payment Amount static |
-| T-<next+2> | Payment Detail: session assignment visible & robust           | ⏳ | Zero-state; selection updates Remaining; persist |
-| T-<next+3> | Add Payment dialog cascade (Method/Entity/Bank/Account/Ref)   | ⏳ | ERL banks→accounts; identifier build; audit fields |
-| T-<next+4> | Payment History: For Session(s) shows ≤5 then … (list view)   | ⏳ | Detail already truncates; list column to match |
-| T-<next+5> | Column header width decouple (narrow even when header long)   | ⏳ | th ellipsis; table-layout fixed; cell widths OK |
-
-Prompts table — update
-
-Keep P-024 and P-025 linked to prompts/p-024.md / prompts/p-025.md. 
-
-Add P-026 as 🧭 (planned) linked to prompts/p-026.md with the summary from this prompt.
-
-Formatting rules
-
-Preserve section headings/casing: “Task Log”, “Latest change summary”, “Tasks table — add/update:”, “Prompts table — update:”.
-
-Append-only; don’t rewrite earlier entries.
-
-Ensure docs/task-log-vol-1.md does not exist (delete if present).
-
-Commit plan
-
-docs(task-log): add P-024/P-025 bullets; mark completed; queue P-026 tasks
-
-docs: ensure only docs/Task Log.md is used (remove stray task-log-vol-1.md if present)
-
-Acceptance
-
-docs/Task Log.md updated with the bullets above, statuses adjusted, and P-026 queued.
-
-No other docs or workflows touched.
diff --git a/prompts/tasklog-update-p-025.md b/prompts/tasklog-update-p-025.md
deleted file mode 100644
index 7999721..0000000
--- a/prompts/tasklog-update-p-025.md
+++ /dev/null
@@ -1,94 +0,0 @@
-# Task Log update — reflect P-024 progress and queue P-025 items (one-off)
-
-**Save this prompt file at:** `prompts/tasklog-update-p-025.md`
-**Branch:** `codex/docs-task-log-update-p025`
-**PR title:** `docs(task-log): reflect P-024 progress; queue P-025 items`
-**Labels:** `docs`, `codex`
-
-## Context (facts from PR #213)
-
-* P-024 added **Payment History columns** (`Method`, `Entity`, `Bank Account`, `Reference #`) and safe fallbacks. ([GitHub][1])
-* P-024 added **“For Session(s)” truncation with “View all”** in **Payment Detail** and surfaced **Bank Account (identifier)** and **Reference #** in the detail panel. ([GitHub][1])
-* P-024 normalized **payment identifier** on save and introduced helpers/tests (`buildIdentifier`, `truncateList`, Jest config). ([GitHub][1])
-* P-024 mistakenly created `docs/task-log-vol-1.md`; our canonical log is `docs/Task Log.md`. ([GitHub][1])
-
-## What to change
-
-### 0) Remove the wrong file
-
-* **Delete** `docs/task-log-vol-1.md` from the repo. (We only maintain `docs/Task Log.md`.)
-
-### 1) Update `docs/Task Log.md` — “Latest change summary”
-
-Append a new block of bullets **at the top** (keep existing bullets; this is append-only) summarizing P-024’s actual outcomes:
-
-* Payment History: headers finalized (`Method`, `Entity`, `Bank Account`, `Reference #`). ([GitHub][1])
-* Payment Detail: “For Session(s)” truncates to 5 with **View all/Hide**; shows `identifier` and `refNumber` with safe fallback. ([GitHub][1])
-* Payments: `identifier` normalized on write; helpers + unit tests added (format & truncate). ([GitHub][1])
-* Sticky footer scaffolding landed (needs follow-up to anchor **Back** inside footer).
-
-### 2) Update “Tasks table” rows (edit in place; keep order/style)
-
-* Mark as **✅** (completed by P-024):
-
-  * **T-077** — Payment list: rename columns; add Method & Entity. ([GitHub][1])
-  * **T-078** — Payment detail: two-column summary layout (plus fields for identifier/ref #). ([GitHub][1])
-  * **T-079** — Tests: formatters & truncate helpers (Jest), plus e2e spec scaffold. ([GitHub][1])
-
-* Keep as **⏳ / 🧭** (not finished by P-024):
-
-  * **T-074** — Sticky dialog footer: **set to ⏳** with note “Back button still attached to scroller; move into footer in P-025.”
-  * **T-073** — Payment History “For Session(s)” max 5: **review current behavior**; if not implemented in the list view, leave as 🧭 with note “detail-only; list pending.”
-
-* Leave other rows as-is unless clearly impacted by P-024 (e.g., T-075/T-076 remain 🧭).
-
-> Keep the **emoji states** exactly as the file’s convention: ✅ done, ⏳ in progress, 🧭 planned.
-
-### 3) Add new **P-025** follow-up tasks (new rows)
-
-Add **new** tasks at the end of the “Tasks table — add/update” section using the next available IDs (compute `next = max(existing T-xxx) + 1`, then increment). Use these titles/notes:
-
-```
-| T-<next>   | StudentDialog Back button inside sticky footer                | ⏳ | Move Back into footer bar; ensure body has bottom padding |
-| T-<next+1> | Payment Detail blink logic: only Remaining blinks             | ⏳ | Payment Amount static; Remaining uses blink class only |
-| T-<next+2> | Payment Detail: restore session assignment list & flow        | ⏳ | Keep assignable list visible; selection updates Remaining; persist |
-| T-<next+3> | Payment Detail inline editing (Method/Entity/Identifier/Ref) | ⏳ | Editable when empty; read-only after set; normalize identifier |
-| T-<next+4> | Base Rate History: inline edit `effectiveDate` when empty     | ⏳ | Editable when missing; read-only after set |
-```
-
-### 4) Update “Prompts table — update”
-
-* Ensure **P-024** remains **⏳** (PR #213 open) and links to `prompts/p-024.md`. ([GitHub][1])
-* Add a new row for **P-025** with state **🧭** (planned) linking to `prompts/p-025.md` and the summary:
-
-  > Fix sticky Back button; blink logic; session assignment; inline editing in Payment Detail & Base Rate History; remove `docs/task-log-vol-1.md`.
-
-### 5) Preserve formatting, anchors, and headings
-
-* Keep the existing **heading text, casing, and spacing** exactly (“Task Log”, “Latest change summary”, “Tasks table — add/update:”, “Prompts table — update:”).
-* Do **not** reorder prior entries or change older statuses unless specified above.
-* Add a tiny “Docs housekeeping” note if the file already references the stray log.
-
-## Commit plan (squash allowed)
-
-* `docs(task-log): add P-024 summary; mark T-077/078/079 ✅; queue P-025 tasks`
-* `docs: remove docs/task-log-vol-1.md (canonical is docs/Task Log.md)`
-
-## Acceptance
-
-* `docs/task-log-vol-1.md` removed.
-* `docs/Task Log.md` shows:
-
-  * New P-024 bullets in **Latest change summary** (as above).
-  * `T-077/078/079` = ✅ with brief notes.
-  * New T rows for P-025 (five items) with correct next IDs and states.
-  * **Prompts** table: P-024 = ⏳ linked; P-025 = 🧭 linked.
-* No other sections altered.
-
-**Do not** touch CI or any workflows.
-
----
-
-**Save this prompt file as-is** at `prompts/tasklog-update-p-025.md`, then open the docs PR.
-
-[1]: https://github.com/Artifact-of-the-Establisher/ArtifactoftheEstablisher/pull/213
```
