P-022 — Finish P-021 acceptance & add scan status/logs, base-rate info relocation, Payment blink hook-up, label tidy

Save to: prompts/P-022.md
In this PR: Do not modify docs/Task Log.md.
PR comment: Include the Context Bundle raw link.

Goals

Payment History blink (complete): In the Amount Received cell, add the actual class toggles:

yellow blink when remainingAmount > 0

red blink when remainingAmount < minUnpaidRate(rows) (ignoring voucher/retainer/assigned).
Respect prefers-reduced-motion with static warn/error colors. Mirror the same states in Payment Detail for the selected payment.

Move Base-Rate info entry point: Remove info button from Session Detail and add the info icon to Billing tab → Base Rate field label (opens Base Rate History dialog).

Calendar scan UX:

Show toast/snackbar with success/failure message from /api/calendar-scan.

Add small status caption in the Tools menu: last scan time + result (“OK”, “Full resync”, “Auth error”, etc.).

Optional: write ScanLogs (last 20) with {at, mode, ok, message}; list the latest one inline in the caption.

Label consistency: Change “Joint Date” → “Joined Date” across Overview and any related surfaces.

Housekeeping: Ensure only one prompts/P-021.md exists (keep the 113-line version).

Acceptance

Payment list and detail both show yellow/red appropriately; reduced-motion users see static styling.

Clicking the info icon beside Base Rate (Billing tab) opens the Base Rate History dialog; no duplicate icon in Session Detail.

Incremental and full calendar rescans surface clear messages; UI shows the last scan status/time.

“Joined Date” appears consistently.

Repo contains a single prompts/P-021.md.

Files you’ll likely touch

components/StudentDialog/PaymentHistory.tsx, components/StudentDialog/PaymentDetail.tsx, styles/studentDialog.css (blink classes)

components/StudentDialog/BillingTab.tsx, components/StudentDialog/SessionDetail.tsx (info icon relocation)

components/Tools/* or where the scan controls live (caption + toast handling)

components/StudentDialog/OverviewTab.tsx (label)

(Optional) lib/scanLogs.ts and Firestore writes/reads for logs

Tests

Unit: blink state selector given (remaining, minUnpaidRate).

E2E: info icon opens the dialog from Billing tab; rescan shows a toast with server message; Tools caption updates.

PR checklist

Context Bundle with before/after and test steps

No Task Log edits

Reduced-motion verified

Payment blink CSS tokens reused in both list and detail
